{% extends 'student/base_student.html' %}
{% block title %}Announcements | MMUEvent{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 900px;">
    
    <div class="text-center mb-5">
        <h2 class="font-weight-bold" style="color: #000;">Campus Announcements</h2>
        <p class="text-muted">Click on an announcement to view the full message.</p>
    </div>

    {% if announcements|length == 0 %}
        <div class="alert alert-light text-center py-5 shadow-sm rounded border">
            <div class="mb-3"><i class="far fa-bell-slash fa-3x text-muted"></i></div>
            <h4>No announcements for students yet.</h4>
        </div>
    {% else %}
        <div class="list-group shadow-sm">
            {% for ann in announcements %}
            <a href="#" 
               class="list-group-item list-group-item-action flex-column align-items-start p-4 border-0 mb-3 rounded shadow-sm"
               style="cursor: pointer; transition: transform 0.2s;"
               onmouseover="this.style.transform='scale(1.01)'"
               onmouseout="this.style.transform='scale(1)'"
               data-id="{{ ann.announcement_id }}"
               data-title="{{ ann.title }}"
               data-content="{{ ann.message }}" 
               onclick="openAnnouncement(this); return false;">
                
                <div class="d-flex w-100 justify-content-between align-items-center">
                    <h5 class="mb-1 font-weight-bold text-primary">
                        <i class="fas fa-bullhorn mr-2"></i> {{ ann.title }}
                    </h5>
                    
                    <div class="d-flex align-items-center">
                        <small class="text-muted mr-2">
                            {{ ann.sent_at.strftime('%d %b, %I:%M %p') if ann.sent_at else '' }}
                        </small>
                        <span class="badge badge-info shadow-sm" id="badge-{{ ann.announcement_id }}">New</span>
                    </div>
                </div>
                
                <small class="text-muted mt-2 d-block">Click to read details...</small>
            </a>
            {% endfor %}
        </div>
    {% endif %}

</div>

<div class="modal fade" id="announcementModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title font-weight-bold" id="modalTitle">Announcement Title</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-4">
        <p id="modalContent" class="text-dark" style="white-space: pre-wrap; font-size: 1.1rem; line-height: 1.6;"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
    function openAnnouncement(element) {
        var id = element.getAttribute('data-id');
        var title = element.getAttribute('data-title');
        var content = element.getAttribute('data-content');
        
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('modalContent').innerText = content;
        
        $('#announcementModal').modal('show');
        
        var badge = document.getElementById('badge-' + id);
        if(badge) {
            badge.style.display = 'none';
        }
        
        markAsReadStorage(id);
    }

    function markAsReadStorage(id) {
        var readList = JSON.parse(localStorage.getItem('read_announcements') || '[]');
        if (!readList.includes(id)) {
            readList.push(id);
            localStorage.setItem('read_announcements', JSON.stringify(readList));
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        var readList = JSON.parse(localStorage.getItem('read_announcements') || '[]');
        readList.forEach(function(id) {
            var badge = document.getElementById('badge-' + id);
            if(badge) {
                badge.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}