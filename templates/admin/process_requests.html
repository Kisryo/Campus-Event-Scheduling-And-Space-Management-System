{% extends 'admin/base_admin.html' %}
{% block title %}Process Requests | Admin{% endblock %}

{% block content %}

<div class="container mt-4">

    <h2 class="mb-4">
        <i class="fas fa-tasks mr-2"></i> Process Booking Requests
    </h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="card shadow-sm mb-5">
        <div class="card-header">
            <h5><i class="fas fa-building mr-2"></i> Pending Venue Bookings</h5>
        </div>

        <div class="card-body p-0">
            {% if venue_requests|length == 0 %}
                <div class="empty-state text-center">
                    <i class="fas fa-check-circle fa-2x mb-2"></i><br>
                    No pending venue requests.
                </div>
            {% else %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Requester</th>
                                <th>Event Details</th> 
                                <th>Room</th>
                                <th>Date Needed</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for b in venue_requests %}
                            <tr>
                                <td>#{{ b.booking_id }}</td>
                                <td>{{ b.req_organizer_id or b.req_lecturer_id }}</td> <td>
                                    <div class="font-weight-bold text-dark">{{ b.event.title }}</div>
                                    <small class="text-muted d-block" style="max-width: 250px; line-height: 1.2;">
                                        {{ b.event.description | truncate(60) }}
                                    </small>
                                </td>
                                
                                <td>{{ b.room.room_name }}</td>
                                <td>
                                    {{ b.req_start_datetime.strftime('%Y-%m-%d %I:%M %p') }}<br>
                                    <small class="text-muted">
                                        to {{ b.req_end_datetime.strftime('%Y-%m-%d %I:%M %p') }}
                                    </small>
                                </td>
                                <td class="text-center">
                                    <a href="{{ url_for('admin_view.booking_action', booking_id=b.booking_id, action='approve') }}"
                                       class="btn btn-success btn-sm"
                                       onclick="return confirm('Approve this booking?');">
                                       <i class="fas fa-check"></i> Approve
                                    </a>
                                    <a href="{{ url_for('admin_view.booking_action', booking_id=b.booking_id, action='reject') }}"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('Reject this booking?');">
                                       <i class="fas fa-times"></i> Reject
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="card shadow-sm mb-5">
        <div class="card-header">
            <h5><i class="fas fa-tools mr-2"></i> Pending Equipment Requests</h5>
        </div>

        <div class="card-body p-0">
            {% if equipment_requests|length == 0 %}
                <div class="empty-state text-center">
                    <i class="fas fa-check-circle fa-2x mb-2"></i><br>
                    No pending equipment requests.
                </div>
            {% else %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Event ID</th>
                                <th>Event Details</th> 
                                <th>Item</th>
                                <th>Qty</th>
                                <th>Date Needed</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in equipment_requests %}
                            <tr>
                                <td>#{{ r.request_id }}</td>
                                <td>#{{ r.event_id }}</td> <td>
                                    <div class="font-weight-bold text-dark">{{ r.event.title }}</div>
                                    <small class="text-muted d-block" style="max-width: 250px; line-height: 1.2;">
                                        {{ r.event.description | truncate(60) }}
                                    </small>
                                </td>

                                <td class="font-weight-bold">{{ r.equipment.item_name }}</td>
                                <td>{{ r.quantity }}</td>
                                <td>
                                    {{ r.event.start_datetime.strftime('%Y-%m-%d %I:%M %p') }}<br>
                                    <small class="text-muted">
                                        to {{ r.event.end_datetime.strftime('%Y-%m-%d %I:%M %p') }}
                                    </small>
                                </td>
                                <td class="text-center">
                                    <a href="{{ url_for('admin_view.equipment_action', req_id=r.request_id, action='approve') }}"
                                       class="btn btn-success btn-sm"
                                       onclick="return confirm('Approve this request?');">
                                       <i class="fas fa-check"></i> Approve
                                    </a>
                                    <a href="{{ url_for('admin_view.equipment_action', req_id=r.request_id, action='reject') }}"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('Reject this request?');">
                                       <i class="fas fa-times"></i> Reject
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>

</div>

<style>
/* =============================
   GENERAL LAYOUT
============================= */
.container {
    max-width: 1200px;
}

h2 {
    font-weight: 700;
    color: #2c3e50;
}

/* =============================
   ALERTS
============================= */
.alert {
    border-radius: 10px;
    font-size: 0.95rem;
}

/* =============================
   CARD DESIGN
============================= */
.card {
    border-radius: 15px;
    border: none;
    overflow: hidden;
}

.card-header {
    background: linear-gradient(135deg, #1d4ed8, #2563eb);
    color: white;
    padding: 15px 25px;
}

.card-header h5 {
    margin: 0;
    font-weight: 600;
}

/* =============================
   TABLE STYLING
============================= */
.table {
    margin-bottom: 0;
}

.table thead th {
    border-top: none;
    font-weight: 600;
    color: #374151;
    background-color: #f8fafc;
}

.table tbody tr {
    transition: all 0.2s ease;
}

.table tbody tr:hover {
    background-color: #f1f5f9;
}

.table td {
    vertical-align: middle;
    font-size: 0.95rem;
}

/* =============================
   BUTTONS
============================= */
.btn-sm {
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 600;
}

.btn-success {
    background-color: #16a34a;
    border: none;
}

.btn-danger {
    background-color: #dc2626;
    border: none;
}

.btn-success:hover {
    background-color: #15803d;
}

.btn-danger:hover {
    background-color: #b91c1c;
}

/* =============================
   EMPTY STATE
============================= */
.empty-state {
    padding: 40px;
    font-size: 1rem;
    color: #6b7280;
}

/* =============================
   BADGES & TEXT
============================= */
.text-muted {
    font-size: 0.85rem;
    color: #6b7280 !important;
}

.font-weight-bold {
    color: #111827;
}
</style>

{% endblock %}
